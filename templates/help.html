{% extends "base.html" %}

{% block title %}Help & User Guide - Trip Manager{% endblock %}

{% block content %}
<div class="px-4 py-6 sm:px-0">
    <div class="max-w-4xl mx-auto">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-2">Help & User Guide</h1>
            <p class="text-lg text-gray-600">Learn how to use the Affinity LeafTrade BioTrack system</p>
        </div>

        <!-- Purpose of this application -->
        <div id="purpose" class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
            <div class="flex items-center mb-4">
                <div class="w-8 h-8 bg-indigo-100 rounded-lg flex items-center justify-center mr-3">
                    <svg class="w-5 h-5 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                    </svg>
                </div>
                <h2 class="text-xl font-semibold text-gray-900">Purpose of this application</h2>
            </div>
            <p class="text-gray-700 mb-4">This app is a BioTrack API tool built for Connecticut producers to eliminate the manual data entry that slows down manifesting and fulfillment in the seed-to-sale system.</p>
            <div class="bg-indigo-50 rounded-lg p-4 mb-4">
                <h3 class="font-medium text-indigo-900 mb-2">What it does:</h3>
                <ul class="text-indigo-800 space-y-1 text-sm">
                    <li>• Connects directly to your order source (LeafTrade) so every transaction is accurate and one-to-one—no re-keying or duplicate entry</li>
                    <li>• Automates the sync between orders and the state compliance system (BioTrack), so manifests and inventory moves happen without manual clicking</li>
                    <li>• Lets your team focus on production and product instead of spending hours in BioTrack on data entry</li>
                </ul>
            </div>
            <div class="bg-green-50 rounded-lg p-4">
                <h3 class="font-medium text-green-900 mb-2">Why it matters:</h3>
                <ul class="text-green-800 space-y-1 text-sm">
                    <li>• Removes redundant manual work and cuts the risk of errors from double entry</li>
                    <li>• High-volume teams often save dozens of hours per month by automating this workflow</li>
                </ul>
            </div>
        </div>

        <!-- Quick Navigation -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-8">
            <h2 class="text-lg font-semibold text-gray-900 mb-4">Quick Navigation</h2>
            <div class="grid grid-cols-2 md:grid-cols-6 gap-3">
                <a href="#purpose" class="text-blue-600 hover:text-blue-800 text-sm font-medium">Purpose</a>
                <a href="#configuration" class="text-blue-600 hover:text-blue-800 text-sm font-medium">Configuration</a>
                <a href="#mapping" class="text-blue-600 hover:text-blue-800 text-sm font-medium">Mapping</a>
                <a href="#new-trip" class="text-blue-600 hover:text-blue-800 text-sm font-medium">New Trip</a>
                <a href="#trip-validation" class="text-blue-600 hover:text-blue-800 text-sm font-medium">Trip Validation</a>
                <a href="#trip-execution" class="text-blue-600 hover:text-blue-800 text-sm font-medium">Trip Execution</a>
                <a href="#trip-status" class="text-blue-600 hover:text-blue-800 text-sm font-medium">Trip Status</a>
            </div>
        </div>

        <!-- Configuration Section -->
        <div id="configuration" class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
            <div class="flex items-center mb-4">
                <div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center mr-3">
                    <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                </div>
                <h2 class="text-xl font-semibold text-gray-900">Configuration</h2>
            </div>
            <p class="text-gray-700 mb-4">Before you start using the system, you need to set up your connections and load your data.</p>
            
            <div class="bg-blue-50 rounded-lg p-4 mb-4">
                <h3 class="font-medium text-blue-900 mb-2">What to do:</h3>
                <ul class="text-blue-800 space-y-1 text-sm">
                    <li>• Go to the Config page to connect to BioTrack and LeafTrade</li>
                    <li>• Click "Refresh Drivers" to load all available drivers from BioTrack</li>
                    <li>• Click "Refresh Vehicles" to load all available vehicles from BioTrack</li>
                    <li>• Make sure your API keys and connections are working properly</li>
                </ul>
            </div>
            
            <div class="bg-green-50 rounded-lg p-4">
                <h3 class="font-medium text-green-900 mb-2">Why it matters:</h3>
                <ul class="text-green-800 space-y-1 text-sm">
                    <li>• Without drivers and vehicles loaded, you can't create trips</li>
                    <li>• The system needs to know what resources are available to assign</li>
                </ul>
            </div>
        </div>

        <!-- Mapping Section -->
        <div id="mapping" class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
            <div class="flex items-center mb-4">
                <div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center mr-3">
                    <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                </div>
                <h2 class="text-xl font-semibold text-gray-900">Mapping</h2>
            </div>
            <p class="text-gray-700 mb-4">The Mapping page helps you connect customer locations between LeafTrade and BioTrack.</p>
            
            <div class="bg-blue-50 rounded-lg p-4 mb-4">
                <h3 class="font-medium text-blue-900 mb-2">What to do:</h3>
                <ul class="text-blue-800 space-y-1 text-sm">
                    <li>• View the list of customer locations from both systems</li>
                    <li>• Match LeafTrade locations with their BioTrack equivalents</li>
                    <li>• Update any missing or incorrect mappings</li>
                    <li>• This ensures orders go to the right places</li>
                </ul>
            </div>
            
            <div class="bg-green-50 rounded-lg p-4">
                <h3 class="font-medium text-green-900 mb-2">Why it matters:</h3>
                <ul class="text-green-800 space-y-1 text-sm">
                    <li>• Wrong location mappings mean drivers go to the wrong addresses</li>
                    <li>• Accurate mapping prevents delivery mistakes</li>
                </ul>
            </div>
        </div>

        <!-- New Trip Section -->
        <div id="new-trip" class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
            <div class="flex items-center mb-4">
                <div class="w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center mr-3">
                    <svg class="w-5 h-5 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                    </svg>
                </div>
                <h2 class="text-xl font-semibold text-gray-900">New Trip</h2>
            </div>
            <p class="text-gray-700 mb-4">This is where you create delivery trips by combining orders, drivers, and vehicles.</p>
            
            <div class="bg-blue-50 rounded-lg p-4 mb-4">
                <h3 class="font-medium text-blue-900 mb-2">What to do:</h3>
                <ol class="text-blue-800 space-y-2 text-sm">
                    <li><strong>1. Load Orders:</strong> Click "Load Orders" to see available orders from LeafTrade</li>
                    <li><strong>2. Select Orders:</strong> Check the boxes for orders you want to deliver</li>
                    <li><strong>3. Set Stop Numbers:</strong> Give each order a stop number (1, 2, 3, etc.) - must start at 1 with no gaps</li>
                    <li><strong>4. Pick Drivers:</strong> Select two different drivers from the dropdowns</li>
                    <li><strong>5. Pick Vehicle:</strong> Choose a vehicle for the trip</li>
                    <li><strong>6. Set Schedule:</strong> Pick delivery date and start time</li>
                    <li><strong>7. Review:</strong> Check the trip summary at the bottom</li>
                    <li><strong>8. Create:</strong> Click "Create Trip" when everything looks right</li>
                </ol>
            </div>
            
            <div class="bg-green-50 rounded-lg p-4">
                <h3 class="font-medium text-green-900 mb-2">Why it matters:</h3>
                <ul class="text-green-800 space-y-1 text-sm">
                    <li>• Stop numbers tell drivers the order to make deliveries</li>
                    <li>• Two drivers are required for safety and efficiency</li>
                    <li>• The system validates everything before creating the trip</li>
                </ul>
            </div>
        </div>

        <!-- Trip Validation Section -->
        <div id="trip-validation" class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
            <div class="flex items-center mb-4">
                <div class="w-8 h-8 bg-yellow-100 rounded-lg flex items-center justify-center mr-3">
                    <svg class="w-5 h-5 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </div>
                <h2 class="text-xl font-semibold text-gray-900">Trip Validation</h2>
            </div>
            <p class="text-gray-700 mb-4">The system checks your trip setup to make sure everything is correct.</p>
            
            <div class="bg-blue-50 rounded-lg p-4 mb-4">
                <h3 class="font-medium text-blue-900 mb-2">What it checks:</h3>
                <ul class="text-blue-800 space-y-1 text-sm">
                    <li>• At least one order is selected</li>
                    <li>• Two different drivers are picked</li>
                    <li>• A vehicle is selected</li>
                    <li>• Delivery date and start time are set</li>
                    <li>• Stop numbers are sequential (1, 2, 3, no gaps)</li>
                    <li>• All orders have the same delivery date</li>
                </ul>
            </div>
            
            <div class="bg-green-50 rounded-lg p-4">
                <h3 class="font-medium text-green-900 mb-2">What happens if something's wrong:</h3>
                <ul class="text-green-800 space-y-1 text-sm">
                    <li>• You'll see a red error message explaining the problem</li>
                    <li>• The trip won't be created until you fix all issues</li>
                    <li>• Common fixes are shown in the instructions</li>
                </ul>
            </div>
        </div>

        <!-- Trip Execution Section -->
        <div id="trip-execution" class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
            <div class="flex items-center mb-4">
                <div class="w-8 h-8 bg-indigo-100 rounded-lg flex items-center justify-center mr-3">
                    <svg class="w-5 h-5 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                    </svg>
                </div>
                <h2 class="text-xl font-semibold text-gray-900">Trip Execution</h2>
            </div>
            <p class="text-gray-700 mb-4">Once your trip is created, it's sent to BioTrack for driver assignment and execution.</p>
            
            <div class="bg-blue-50 rounded-lg p-4 mb-4">
                <h3 class="font-medium text-blue-900 mb-2">What happens next:</h3>
                <ul class="text-blue-800 space-y-1 text-sm">
                    <li>• The trip appears in your Trips list</li>
                    <li>• BioTrack assigns the trip to your selected drivers</li>
                    <li>• Drivers receive the route on their devices</li>
                    <li>• You can track progress and make changes if needed</li>
                </ul>
            </div>
            
            <div class="bg-green-50 rounded-lg p-4">
                <h3 class="font-medium text-green-900 mb-2">Monitoring:</h3>
                <ul class="text-green-800 space-y-1 text-sm">
                    <li>• Check the Trips page to see all your created trips</li>
                    <li>• View trip details to see the full route and order information</li>
                    <li>• Update trip status as deliveries are completed (see <a href="#trip-status" class="text-blue-600 hover:text-blue-800 underline">Trip Status Management</a> section)</li>
                </ul>
            </div>
        </div>

        <!-- Trip Status Management Section -->
        <div id="trip-status" class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
            <div class="flex items-center mb-4">
                <div class="w-8 h-8 bg-teal-100 rounded-lg flex items-center justify-center mr-3">
                    <svg class="w-5 h-5 text-teal-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path>
                    </svg>
                </div>
                <h2 class="text-xl font-semibold text-gray-900">Trip Status Management</h2>
            </div>
            <p class="text-gray-700 mb-4">Manage trip statuses using the dropdown menu on the trips dashboard or trip detail page.</p>
            
            <div class="bg-blue-50 rounded-lg p-4 mb-4">
                <h3 class="font-medium text-blue-900 mb-2">How to Change Status:</h3>
                <ul class="text-blue-800 space-y-1 text-sm">
                    <li>• On the <strong>Trips Dashboard:</strong> Use the dropdown menu next to the status badge in the table</li>
                    <li>• On the <strong>Trip Detail Page:</strong> Use the dropdown menu next to the status badge in the status section</li>
                    <li>• Select the desired status from the dropdown</li>
                    <li>• Confirm the change when prompted</li>
                    <li>• The page will refresh to show the updated status</li>
                </ul>
            </div>
            
            <div class="bg-green-50 rounded-lg p-4 mb-4">
                <h3 class="font-medium text-green-900 mb-2">Statuses guide:</h3>
                <p class="text-green-800 text-sm mb-2">What each trip status means and when you can execute:</p>
                <dl class="text-green-800 space-y-2 text-sm">
                    <div><dt class="font-medium">Pending</dt><dd class="ml-0 mt-0.5">(Yellow badge) — Trip created; awaiting validation and execution. Execute button is available. You can change drivers on the trip detail page while pending.</dd></div>
                    <div><dt class="font-medium">Validated</dt><dd class="ml-0 mt-0.5">(Orange badge) — Pre-checks passed (e.g. different drivers, inventory available for fulfillment). Ready to execute. Execute button is available.</dd></div>
                    <div><dt class="font-medium">Partially completed</dt><dd class="ml-0 mt-0.5">(Orange badge) — Some BioTrack steps ran (e.g. inventory sublotted) but manifest or another step failed. Check BioTrack before retrying or closing. Execute button is hidden.</dd></div>
                    <div><dt class="font-medium">Completed</dt><dd class="ml-0 mt-0.5">(Blue badge) — All orders sublotted and manifested successfully. Execute button is hidden.</dd></div>
                    <div><dt class="font-medium">Closed</dt><dd class="ml-0 mt-0.5">(Gray badge) — Trip is inactive; closed to prevent accidental execution. Use for trips created by mistake or no longer needed.</dd></div>
                </dl>
            </div>
            
            <div class="bg-yellow-50 rounded-lg p-4">
                <h3 class="font-medium text-yellow-900 mb-2">Important Notes:</h3>
                <ul class="text-yellow-800 space-y-1 text-sm">
                    <li>• The <strong>Execute</strong> button only appears for trips with "Pending" or "Validated" status</li>
                    <li>• Use <strong>Closed</strong> status for trips created by accident or no longer needed</li>
                    <li>• Closed trips cannot be executed - this prevents accidental processing</li>
                    <li>• You can change a trip's status at any time using the dropdown menu</li>
                    <li>• Status changes are saved immediately after confirmation</li>
                </ul>
            </div>
        </div>

        <!-- Need Help Section -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
            <div class="flex items-center mb-4">
                <div class="w-8 h-8 bg-red-100 rounded-lg flex items-center justify-center mr-3">
                    <svg class="w-5 h-5 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </div>
                <h2 class="text-xl font-semibold text-gray-900">Need Help?</h2>
            </div>
            
            <div class="bg-gray-50 rounded-lg p-4">
                <ul class="text-gray-700 space-y-2 text-sm">
                    <li>• Check the error messages - they usually tell you exactly what to fix</li>
                    <li>• Make sure all required fields are filled out</li>
                    <li>• Verify your BioTrack and LeafTrade connections are working</li>
                    <li>• Contact support if you keep getting errors</li>
                </ul>
            </div>
        </div>

        <!-- Back to Top Button -->
        <div class="text-center">
            <button onclick="window.scrollTo({top: 0, behavior: 'smooth'})" 
                    class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
                </svg>
                Back to Top
            </button>
        </div>
    </div>
</div>
{% endblock %}
